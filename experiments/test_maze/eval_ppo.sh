export TOKENIZERS_PARALLELISM=false
export GOOGLE_APPLICATION_CREDENTIALS="/nfs/nfs1/users/isadoracw/rail-tpus.json"
export GCLOUD_PROJECT="rail-tpus"
# sudo chmod -R 777 /nfs/nfs1/users/isadoracw/LLM_RL
git config --global --add safe.directory /nfs/nfs1/users/isadoracw/LLM_RL
sudo rm -r /tmp/*tpu*
# python /nfs/nfs1/users/isadoracw/LLM_RL/llm_rl_scripts/chess/train_ppo_gpt2_online_endgames.py HF outputs/chess/test_bc_shuffled2/model/ --n-rounds 100 --exp-name ppo_online_endgames_lr1e-5_bsize256 --wandb-project ppo_endgames --model-mesh-shape 4 --n-rollouts 16 --num_pos_per_setup 4 --ppo-data-bsize 8 --use-wandb --train-bsize 8 --grad-accum-steps 16 --lr 1e-5
# python /nfs/nfs1/users/isadoracw/LLM_RL/llm_rl_scripts/chess/train_ppo_gpt2_online_endgames.py HF outputs/chess/test_bc_shuffled2/model/ --n-rounds 100 --exp-name ppo_online_endgames_lr1e-5_bsize256_1roll_256pos --wandb-project ppo_endgames --model-mesh-shape 4 --n-rollouts 1 --num_pos_per_setup 64 --ppo-data-bsize 8 --use-wandb --train-bsize 8 --grad-accum-steps 16 --lr 1e-5
export maze_name="double_t_maze"
#todo: fix this, this crashes when the trajectory length is too long!
# python llm_rl_scripts/eval_maze/eval_ppo.py --exp-name ppo_"$maze_name"_give_position_new_reward --model-load-path gcs://rail-tpus-isadora/maze/maze_double_t_maze/double_t_maze_give_position_bc/model_141000/ --checkpoint-dir gcs://rail-tpus-isadora/maze/maze_double_t_maze/ppo_double_t_maze_give_position_illegal_penalty/ppo_double_t_maze_give_position_illegal_penalty.2023-08-01-17-12-02.613.8859c734308e11eea4fc81b6ec24b0f2/round_59/ --model-mesh-shape 1 --data-mesh-shape 1 --fsdp-mesh-shape 2 --n-rollouts 1024
# python llm_rl_scripts/eval_maze/eval_ppo.py --exp-name ppo_"$maze_name"_give_position_new_reward_round69 --model-load-path gcs://rail-tpus-isadora/maze/maze_double_t_maze/double_t_maze_give_position_bc/model_141000/ --checkpoint-dir gcs://rail-tpus-isadora/maze/maze_double_t_maze/ppo_double_t_maze_give_position_illegal_penalty/ppo_double_t_maze_give_position_illegal_penalty.2023-08-01-17-12-02.613.8859c734308e11eea4fc81b6ec24b0f2/round_69/ --model-mesh-shape 1 --data-mesh-shape 1 --fsdp-mesh-shape 2 --n-rollouts 1024
for round in 29 39 49
do 
    python llm_rl_scripts/eval_maze/eval_ppo.py --exp-name ppo_"$maze_name"_give_position_new_reward_round"$round" --model-load-path gcs://rail-tpus-isadora/maze/maze_double_t_maze/double_t_maze_give_position_bc/model_141000/ --checkpoint-dir gcs://rail-tpus-isadora/maze/maze_double_t_maze/ppo_double_t_maze_give_position_illegal_penalty/ppo_double_t_maze_give_position_illegal_penalty.2023-08-01-17-12-02.613.8859c734308e11eea4fc81b6ec24b0f2/round_"$round"/ --model-mesh-shape 1 --data-mesh-shape 1 --fsdp-mesh-shape 2 --n-rollouts 1024
done
# python llm_rl_scripts/maze/train_ppo_online.py HF gcs://rail-tpus-isadora/maze/maze_umaze/umaze_give_position_bc/model_22000 --n-rounds 100 --bc-loss-weight 20 --exp-name ppo_"$maze_name"_give_position_no_reranker_bc_loss_20 --wandb-project ppo_"$maze_name" --model-mesh-shape 2 --data-mesh-shape 1 --fsdp-mesh-shape 1 --n-rollouts 64 --ppo-data-bsize 8 --use-wandb --train-bsize 8 --grad-accum-steps 16 --lr 1e-5 --maze-name "$maze_name" --describe-function "describe_observation_give_position" --init-kl-coef 0.001 --bc-data-path /home/isadoracw/isadoracw/LLM_RL/data/maze/umaze_histories_give_position.pkl 
# python llm_rl_scripts/maze/train_ppo_online.py HF gcs://rail-tpus-isadora/maze/maze_umaze/umaze_give_position_bc/model_22000 --n-rounds 100 --exp-name ppo_"$maze_name"_give_position --wandb-project ppo_"$maze_name" --model-mesh-shape 2 --data-mesh-shape 1 --fsdp-mesh-shape 1 --n-rollouts 64 --ppo-data-bsize 8 --use-wandb --train-bsize 8 --grad-accum-steps 16 --lr 1e-6 --maze-name "$maze_name" --describe-function "describe_observation_give_position"